---
title: "Create wide data for table 1 & mediation analyses"
author: "Kate Tran"
date: "6/24/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(dplyr)
library(tidyr)
library(janitor)
library(tableone)
library(data.table)
```

```{r}
dataset_long <- read.csv("../outputs/dataset_SGM_3tp.csv")

# table S1
write.csv(print(CreateTableOne(data = dataset_long, strata = "eventname", addOverall = T,
                               vars = c("age_year", "kbi_y_sex_orient", "kbi_y_trans_id", "LGBT", "LGBT_inclusive"),
                               factorVars = c("kbi_y_sex_orient", "kbi_y_trans_id", "LGBT", "LGBT_inclusive")),
                missing = T), 
          "../outputs/table_S1.csv")
```

```{r}
dataset_long <- dataset_long %>% 
  dplyr::select(
    # demographics
    src_subject_id, eventname,
    sex_br, contains("race"), ethnicity_hisp,
    # state level of nias against SGM
    contains("reshist"),
    # reshist_state_so_factor, reshist_state_sexism_factor, reshist_state_racism_factor, reshist_state_immigrant_factor,
    rel_family_id, site_id_l_br, 
    age_year, parents_avg_edu, household_income,
    # peer victimization
    cybb_phenx_harm, peq_ss_relational_victim, peq_ss_reputation_victim, peq_ss_overt_victim,
    # individual level discrimination
    dim_yesno_q1, dim_yesno_q2, dim_yesno_q3, dim_yesno_q4,
    # diagnoses, symptoms
    contains(c("iagnosis", "symptoms")),
    suicidality_y, SA_y, SI_y,
    # psychopathology
    bpm_y_scr_totalprob_r, bpm_y_scr_totalprob_t, cbcl_scr_syn_totprob_r, cbcl_scr_syn_totprob_t,
    # SGM
    LGBT_inclusive, LGBT
  )

# Wide data
dataset_wide <- dataset_long %>% 
  pivot_wider(names_from = eventname, values_from = site_id_l_br:LGBT, names_sep = "_") %>% 
  # remove empty columns
  remove_empty("cols") %>% 
  # rename site at 1y
  rename(site_id_l_br = "site_id_l_br_1")

write.csv(file = "../outputs/dataset_SGM_wide_3tp.csv", x = dataset_wide, row.names = F, na = "")
```
